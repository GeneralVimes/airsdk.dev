"use strict";(self.webpackChunkairsdk_dev=self.webpackChunkairsdk_dev||[]).push([[6085],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return m}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),d=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},s=function(e){var t=d(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),c=d(n),m=i,h=c["".concat(p,".").concat(m)]||c[m]||u[m]||o;return n?a.createElement(h,r(r({ref:t},s),{},{components:n})):a.createElement(h,r({ref:t},s))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=c;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var d=2;d<o;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},3877:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return d},toc:function(){return s},default:function(){return c}});var a=n(7462),i=n(3366),o=(n(7294),n(3905)),r=["components"],l={title:"Packaging Android App Bundles"},p=void 0,d={unversionedId:"tutorials/platform/android/packaging-android-app-bundles",id:"tutorials/platform/android/packaging-android-app-bundles",isDocsHomePage:!1,title:"Packaging Android App Bundles",description:"This is specific for Google Play Publishing",source:"@site/docs/tutorials/platform/android/packaging-android-app-bundles.md",sourceDirName:"tutorials/platform/android",slug:"/tutorials/platform/android/packaging-android-app-bundles",permalink:"/docs/tutorials/platform/android/packaging-android-app-bundles",editUrl:"https://github.com/airsdk/airsdk.dev/edit/main/docs/tutorials/platform/android/packaging-android-app-bundles.md",tags:[],version:"current",frontMatter:{title:"Packaging Android App Bundles"},sidebar:"mainSidebar",previous:{title:"Overview",permalink:"/docs/tutorials/platform/android/index"},next:{title:"Packaging an IPA",permalink:"/docs/tutorials/platform/ios/packaging-ipa"}},s=[{value:"Packaging",id:"packaging",children:[{value:"Setting the Android SDK",id:"setting-the-android-sdk",children:[]},{value:"Creating the AAB",id:"creating-the-aab",children:[]},{value:"Specifying Certificates",id:"specifying-certificates",children:[]}]},{value:"Signing and Certificates",id:"signing-and-certificates",children:[{value:"Play App Signing",id:"play-app-signing",children:[]}]},{value:"Testing",id:"testing",children:[{value:"Creating a <code>keystore.ks</code>",id:"creating-a-keystoreks",children:[]}]}],u={toc:s};function c(e){var t=e.components,l=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This is specific for Google Play Publishing"))),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Important: From August 2021, new apps are required to publish with the Android App Bundle on Google Play. New apps larger than 150 MB are now supported by either Play Feature Delivery or Play Asset Delivery."))),(0,o.kt)("p",null,"An Android App Bundle is a publishing format that includes all your app\u2019s compiled code and resources, and defers APK generation and signing to Google Play."),(0,o.kt)("p",null,"Google Play uses your app bundle to generate and serve optimized APKs for each device configuration, so only the code and resources that are needed for a specific device are downloaded to run your app. You no longer have to build, sign, and manage multiple APKs to optimize support for different devices, and users get smaller, more-optimized downloads."),(0,o.kt)("p",null,"More information on Android App Bundles ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/guide/app-bundle"},"here"),"."),(0,o.kt)("h2",{id:"packaging"},"Packaging"),(0,o.kt)("p",null,"AIR supports creation of an App Bundle by creating an Android Studio project and using Gradle to build this. ",(0,o.kt)("strong",{parentName:"p"},"It requires an Android SDK to be installed.")," It also needs to have a JDK present and available via the ",(0,o.kt)("inlineCode",{parentName:"p"},"JAVA_HOME")," environment variable."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The creation of an Android App Bundle involves a few steps and can take significantly longer than creating an APK file. We recommend that APK generation is still used during development and testing, and the AAB output can be used when packaging up an application for upload to the Play Store."))),(0,o.kt)("h3",{id:"setting-the-android-sdk"},"Setting the Android SDK"),(0,o.kt)("p",null,"You must download and install the Android SDK to your development machine. The easiest way to do this is to install Android Studio. ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/studio"},"Download"),"."),(0,o.kt)("h4",{id:"using-platformsdk"},"Using ",(0,o.kt)("inlineCode",{parentName:"h4"},"platformsdk")),(0,o.kt)("p",null,"If you use ",(0,o.kt)("inlineCode",{parentName:"p"},"adt")," to package your application you can supply the path to the Android SDK via the ",(0,o.kt)("inlineCode",{parentName:"p"},"-platformsdk")," option:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"adt ... -platformsdk /path/to/android/sdk\n")),(0,o.kt)("h4",{id:"using-an-environment-variable"},"Using an environment variable"),(0,o.kt)("p",null,"You can set the path to the Android SDK by setting an environment variable named ",(0,o.kt)("inlineCode",{parentName:"p"},"AIR_ANDROID_SDK_HOME")," that points to the Android SDK location."),(0,o.kt)("p",null,"This has the advantage of applying the setting to all installs of the AIR SDK."),(0,o.kt)("h4",{id:"using-adtcfg"},"Using ",(0,o.kt)("inlineCode",{parentName:"h4"},"adt.cfg")),(0,o.kt)("p",null,"You can specify the Android SDK in the ",(0,o.kt)("inlineCode",{parentName:"p"},"adt.cfg")," file located at ",(0,o.kt)("inlineCode",{parentName:"p"},"[AIRSDK]/lib/adt.cfg")," and adding the following line:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"AndroidPlatformSDK=/path/to/android/sdk\n")),(0,o.kt)("p",null,"This will need to be updated in every AIR SDK you use."),(0,o.kt)("h3",{id:"creating-the-aab"},"Creating the AAB"),(0,o.kt)("h4",{id:"using-adt"},"Using ",(0,o.kt)("inlineCode",{parentName:"h4"},"adt")),(0,o.kt)("p",null,"To package an AAB using ",(0,o.kt)("inlineCode",{parentName:"p"},"adt")," simply change the target from ",(0,o.kt)("inlineCode",{parentName:"p"},"apk")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"aab")," and ensure you provide the ",(0,o.kt)("inlineCode",{parentName:"p"},"platformsdk")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"adt -package -target aab <signing options> output.aab <app descriptor and files> [-extdir <folder>] -platformsdk <path_to_android_sdk>\n")),(0,o.kt)("h4",{id:"ides-without-direct-options"},"IDE's without direct options"),(0,o.kt)("p",null,"If you are using an IDE that currently cannot change the output target to ",(0,o.kt)("inlineCode",{parentName:"p"},"aab")," you can force AIR to output an ",(0,o.kt)("inlineCode",{parentName:"p"},"aab")," from the normal ",(0,o.kt)("inlineCode",{parentName:"p"},"apk")," packaging process. This is done by setting a configuration option in ",(0,o.kt)("inlineCode",{parentName:"p"},"adt.cfg")," (located at ",(0,o.kt)("inlineCode",{parentName:"p"},"[AIRSDK]/lib/adt.cfg"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"CreateAndroidAppBundle=true\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This will force the output to be in the AAB format, however your IDE may still output a file with the extension of ",(0,o.kt)("inlineCode",{parentName:"p"},"apk"),". If this is the case you will need to rename the output from ",(0,o.kt)("inlineCode",{parentName:"p"},"application.apk")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"application.aab"),"."))),(0,o.kt)("h3",{id:"specifying-certificates"},"Specifying Certificates"),(0,o.kt)("p",null,"TODO"),(0,o.kt)("p",null,"Note that the APK generation here will use a default/debug keystore; additional command-line parameters\ncan be used if the output APK needs to be signed with a particular certificate."),(0,o.kt)("h2",{id:"signing-and-certificates"},"Signing and Certificates"),(0,o.kt)("h3",{id:"play-app-signing"},"Play App Signing"),(0,o.kt)("p",null,"Play App Signing is required for publishing applications using an Android App Bundle."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Allow Google to protect the app signing key for your app and sign each release so Android devices can trust that updates are from you. This is a requirement to publish with the Android App Bundle.")),(0,o.kt)("p",null,"To convert your existing certificate for use with Play App Signing you can use the tool provided by Google to convert and encrypt your certificate file for uploading."),(0,o.kt)("p",null,"Firstly identify the ",(0,o.kt)("strong",{parentName:"p"},"alias")," of your key in your certificate by using the ",(0,o.kt)("inlineCode",{parentName:"p"},"keytool"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"keytool -v -list -keystore YOUR_CERTIFICATE.p12\n")),(0,o.kt)("p",null,"You will need to enter the password and then it should output something like the below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Keystore type: JKS\nKeystore provider: SUN\n\nYour keystore contains 1 entry\n\nAlias name: 1\nCreation date: 03/06/2017\n...\n")),(0,o.kt)("p",null,"Take note of the ",(0,o.kt)("inlineCode",{parentName:"p"},"Alias name: "),', in this case it is "1".'),(0,o.kt)("p",null,'Next, start the process of signing up to "Play App Signing" in the Play console for your applilcation and use the "Export and Upload a key from java keystore" method.'),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'Log into the Play console and find the "App Integrity" page for your application:')),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(1284).Z})),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'Select the "Export and upload a key from Java keystore" option:')),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(4349).Z})),(0,o.kt)("p",null,"This will give you the option to download the PEPK tool (",(0,o.kt)("inlineCode",{parentName:"p"},"pepk.jar"),") and show you an encryption key to use in the command."),(0,o.kt)("p",null,"Use this as below, replacing the alias with the alias name you got above:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"java -jar pepk.jar --keystore=YOUR_CERTIFICATE.p12 --alias=1 --output=playappsigning_encrypted_certificate.zip --encryptionkey=XXXXXXXXX\n")),(0,o.kt)("p",null,"This will create a ",(0,o.kt)("inlineCode",{parentName:"p"},"playappsigning_encrypted_certificate.zip")," file which you can upload to the Play console."),(0,o.kt)("h2",{id:"testing"},"Testing"),(0,o.kt)("p",null,"After you build your Android App Bundle, you should test how Google Play uses it to generate APKs and how those APKs behave when deployed to a device. There are two ways you should consider testing your app bundle: locally using the bundletool command line tool and through Google Play by uploading your bundle to the Play Console and using a test track. This section explains how to use bundletool to test your app bundle locally."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"If you haven't already done so, install bundletool using brew (",(0,o.kt)("inlineCode",{parentName:"p"},"brew install bundletool"),") or download bundletool from the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/google/bundletool/releases"},"GitHub repository"),"."),(0,o.kt)("p",{parentName:"div"},"In all the examples below ",(0,o.kt)("inlineCode",{parentName:"p"},"bundletool")," can be replaced with ",(0,o.kt)("inlineCode",{parentName:"p"},"java -jar bundletool.jar")," if you are using the jar from the repository directly."))),(0,o.kt)("p",null,"When bundletool generates APKs from your app bundle, it includes them in a container called an APK set archive, which uses the .apks file extension. To generate an APK set for all device configurations your app supports from your app bundle, use the bundletool build-apks command, as shown below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"bundletool build-apks --bundle=my_app.aab --output=my_app.apks\n")),(0,o.kt)("p",null,"If you want to deploy the APKs to a device, you need to also include your app\u2019s signing information:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"bundletool build-apks\n    --bundle=my_app.aab\n    --output=my_app.apks\n    --connected-device\n    --ks=YOUR_KEYSTORE.ks\n    --ks-pass=pass:PASSWORD\n    --ks-key-alias=ALIAS\n")),(0,o.kt)("p",null,"(See the section below to create your ",(0,o.kt)("inlineCode",{parentName:"p"},"keystore.ks"),")"),(0,o.kt)("p",null,"Then to install the app to the connected device:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"bundletool install-apks --apks=my_app.apks\n")),(0,o.kt)("p",null,"More information on the bundletool can be found ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/studio/command-line/bundletool"},"here"),"/"),(0,o.kt)("h3",{id:"creating-a-keystoreks"},"Creating a ",(0,o.kt)("inlineCode",{parentName:"h3"},"keystore.ks")),(0,o.kt)("p",null,"You can create a keystore for use in the bundletool from your existing p12 file using the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"keytool -importkeystore\n        -srckeystore YOUR_CERTIFICATE.p12\n        -srcstoretype pkcs12\n        -srcalias 1\n        -destkeystore YOUR_KEYSTORE.ks\n        -deststoretype jks\n        -destalias ALIAS\n")),(0,o.kt)("p",null,"You will need to set the ",(0,o.kt)("inlineCode",{parentName:"p"},"srcalias")," to match the one from your certificate (see above for getting this information) and then set a new ",(0,o.kt)("inlineCode",{parentName:"p"},"ALIAS")," which you will pass to the bundle tool."),(0,o.kt)("p",null,"This will ask for a password for the new keystore and for the password for your existing certificate."))}c.isMDXComponent=!0},4349:function(e,t,n){t.Z=n.p+"assets/images/playappsigning_export_certificate-84bac8237b5f1fea053392d680867fd8.png"},1284:function(e,t,n){t.Z=n.p+"assets/images/playappsigning_setup-253b32881b336d21775cfd5a834c8095.png"}}]);